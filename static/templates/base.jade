| {{define "BASE"}}
| {{template "MIXINS"}}
html
    head
        | {{template "HEAD"}}

        | <link href="{{.ProxyPath}}css/bootstrap.min.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/bootstrap-table.min.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/select2.min.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/bootstrap-colorpicker.min.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/fontawesome.all.min.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/chimitheque.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/materialdesignicons.min.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/bootstrap-toggle.min.css" rel="stylesheet"/>
        | <link href="{{.ProxyPath}}css/animate.min.css" rel="stylesheet"/>
         
        | <script src="{{.ProxyPath}}js/jquery-3.3.1.min.js"></script>
    body
        div#message
        div.container
            | {{template "HEADER"}}
            
            nav.navbar.navbar-expand-lg.navbar-light.bg-light
                a.navbar-brand(href="https://github.com/tbellembois/gochimitheque")
                    img(src="{{.ProxyPath}}img/logo_chimitheque_small.png", alt="chimitheque_logo", title="Chimith√®que")
                button.navbar-toggler(
                                    type="button"
                                    data-toggle="collapse" 
                                    data-target="#navbarSupportedContent" 
                                    aria-controls="navbarSupportedContent" 
                                    aria-expanded="false" 
                                    aria-label="Toggle navigation")
                    span.navbar-toggler-icon

                div.collapse.navbar-collapse#navbarSupportedContent
                    ul.navbar-nav.mr-auto
                        if HasPermission .PersonID "r" "products" -2
                            li.nav-item.active
                                a(href="{{.ProxyPath}}v/products").nav-link
                                    span.mdi.mdi-home.mdi-36px.iconlabel
                                        | {{ T "menu_home" 1 }} 

                        if HasPermission .PersonID "r" "products" -2
                            li.nav-item.active
                                a(href="{{.ProxyPath}}v/products?bookmark=true").nav-link
                                    span.mdi.mdi-star.mdi-36px.iconlabel
                                        | {{ T "menu_bookmark" 1 }} 

                        if HasPermission .PersonID "w" "products" -2
                            li.nav-item
                                a(href="{{.ProxyPath}}vc/products").nav-link
                                    span.mdi.mdi-tag.mdi-36px.iconlabel
                                        | {{ T "menu_create_productcard" 1 }}
                        if HasPermission .PersonID "r" "entities" -2
                            li.nav-item.dropdown
                                a(href="#", title="manage entities").nav-link.dropdown-toggle#navbarDropdown(
                                    role="button" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false")
                                    span.mdi.mdi-store.mdi-36px.iconlabel
                                        | {{ T "menu_entity" 1 }}
                                div.dropdown-menu(aria-labelledby="navbarDropdown")
                                    a(href="{{.ProxyPath}}v/entities", title="list").dropdown-item list
                                    if HasPermission .PersonID "all" "all" -1
                                        a(href="{{.ProxyPath}}vc/entities", title="create").dropdown-item create

                        if HasPermission .PersonID "r" "storages" -2
                            li.nav-item.dropdown
                                a(href="#", title="manage storelocations").nav-link.dropdown-toggle#navbarDropdown(
                                    role="button" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false")
                                    span.mdi.mdi-docker.mdi-36px.iconlabel
                                        | {{ T "menu_storelocation" 1 }}
                                div.dropdown-menu(aria-labelledby="navbarDropdown")
                                    a(href="{{.ProxyPath}}v/storelocations", title="list").dropdown-item list
                                    if HasPermission .PersonID "all" "all" -2
                                        a(href="{{.ProxyPath}}vc/storelocations", title="create").dropdown-item create

                        if HasPermission .PersonID "r" "people" -2
                            li.nav-item.dropdown
                                a(href="#", title="manage people").nav-link.dropdown-toggle#navbarDropdown(
                                    role="button" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false")
                                    span.mdi.mdi-account-group.mdi-36px.iconlabel
                                        | {{ T "menu_people" 1 }}
                                div.dropdown-menu(aria-labelledby="navbarDropdown")
                                    a(href="{{.ProxyPath}}v/people", title="list").dropdown-item list
                                    if HasPermission .PersonID "w" "people" -2
                                        a(href="{{.ProxyPath}}vc/people", title="create").dropdown-item create

                        li.nav-item
                            a.nav-link(title= "change password" href="{{.ProxyPath}}vu/peoplepass")
                                span.mdi.mdi-shield-lock-outline.mdi-36px.iconlabel
                                        | {{ T "menu_password" 1 }}
                                
                        li.nav-item
                            a.nav-link(title= "logout" onclick="localStorage.clear();" href="{{.ProxyPath}}delete-token")
                                span.mdi.mdi-logout.mdi-36px.iconlabel
                                        | {{ T "menu_logout" 1 }}

            | {{template "CONTENT"}}
            | {{template "FOOTER"}}

        | {{template "FOOT"}}
        | {{template "LOCALEJS"}}

        script.
            //
            // common javascript
            //

            // query parameters saved - used for the storages<>products views switch
            var lastQueryParams;

            // proxy path
            var proxyPath = {{ .ProxyPath }};
            
            // request context
            var container = {{ . }};

            // url parameters
            var URLValues = new Map();

            // initializing query parameters map
            {{ range $key, $value := .URLValues }}
                URLValues.set({{ $key }}, {{ $value }});
            {{ end }}

            // setting up logged user
            window.onload = function() {
                // cookie set by the GetTokenHandler() function after login
                var email = readCookie("email")
                var urlParams = new URLSearchParams(window.location.search);
                var message = urlParams.get("message");
                
                if (email != null) {
                    document.getElementById("logged").innerHTML = email;
                }
                if (message != null) {
                    global.displayMessage(message, "success");
                }

           };
           
        | <script src="{{.ProxyPath}}js/jquery.formautofill.min.js"></script>
        | <script src="{{.ProxyPath}}js/jquery.validate.min.js"></script>
        | <script src="{{.ProxyPath}}js/jquery.validate.additional-methods.min.js"></script>
        | <script src="{{.ProxyPath}}js/select2.full.min.js"></script>
        | <script src="{{.ProxyPath}}js/popper.min.js"></script>
        | <script src="{{.ProxyPath}}js/bootstrap.min.js"></script>
        | <script src="{{.ProxyPath}}js/bootstrap-table.min.js"></script>
        | <script src="{{.ProxyPath}}js/bootstrap-confirmation.min.js"></script>
        | <script src="{{.ProxyPath}}js/bootstrap-colorpicker.min.js"></script>
        | <script src="{{.ProxyPath}}js/bootstrap-toggle.min.js"></script>
        | <script src="{{.ProxyPath}}js/JSmol.lite.nojq.js"></script>
        | <script src="{{.ProxyPath}}js/chim/gjs-common.js"></script>
        | <script src="{{.ProxyPath}}js/chim/chimcommon.js"></script>
        | <script src="{{.ProxyPath}}js/chim/chimauth.js"></script>
        
        | {{template "CONTENTJS"}}
| {{end}}
