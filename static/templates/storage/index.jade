extends ../base.jade
block CONTENT
    :go:func
        Storageindex(c ViewContainer)

    #search.row.pt-sm-4.pb-sm-4.pl-sm-2.pr-sm-2.mt-sm-2.mb-sm-2.ml-sm-5.mr-sm-5.bg-light.border.rounded.collapse.show

        +inputhidden(name="s_entity" value="")
        +inputhidden(name="s_product" value="")
        +inputhidden(name="s_history" value="")
        +inputhidden(name="s_storage" value="")
        +inputhidden(name="s_storage_archive" value="")
        +inputhidden(name="s_bookmark" value="")

        .col
            .row
                .col-sm-6
                    +inputtextcompact(T("s_custom_name_part_of", 1), "s_custom_name_part_of")
                .col-sm-6
                    +selectcompact(T("s_casnumber", 1), "s_casnumber")
                .col-sm-6
                    +selectcompact(T("s_empiricalformula", 1), "s_empiricalformula")
                .col-sm-6
                    +inputtextcompact(T("s_storage_barecode", 1), "s_storage_barecode")
            .row.collapse#advancedsearch
                .col-sm-12
                    .form-row
                        .col-sm-6
                            +selecticon("s_storelocation", "docker")
                        .col-sm-6
                            +selectcompact(T("s_name", 1), "s_name")
                    .form-row
                        .form-group.col-sm-6
                            +selectcompact(T("s_signalword", 1), "s_signalword")
                        .form-group.col-sm-6
                            +selectmultiplecompact(T("s_symbols", 1), "s_symbols")
                    .form-row
                        .form-group.col-sm-6
                            +selectmultiplecompact(T("s_hazardstatements", 1), "s_hazardstatements")
                        .form-group.col-sm-6
                            +selectmultiplecompact(T("s_precautionarystatements", 1), "s_precautionarystatements")
                    .form-row
                        .form-group.col-sm-6
                            +checkbox(T("s_casnumber_cmr", 1), "s_casnumber_cmr")
            .row
                .col.col-sm-10
                    button#clearsearch.btn.btn-link.mr-sm-2(type="button" onclick="clearsearch();")
                        span.mdi.mdi-broom.mdi-24px.iconlabel
                            = T("clearsearch_text", 1) 

                    button#search.btn.btn-lg.btn-link.mr-sm-2(type="button" onclick="search();")
                        span.mdi.mdi-magnify.mdi-24px.iconlabel
                            = T("search_text", 1) 
                .col.col-sm-2
                    button.btn.btn-link(data-toggle="collapse" href="#advancedsearch" aria-expanded="false")
                        span.mdi.mdi-magnify-plus-outline.mdi-24px.iconlabel
                            = T("advancedsearch_text", 1) 

    .row
        .col-sm-8
            #filter-item
        .col-sm-2.d-flex.justify-content-end
            #button-store
        .col-sm-2.d-flex.justify-content-end
            #button-stock

    #toolbar.row
        .col.toggleable
            button.btn.btn-link#switchview(type="button" onclick="switchProductStorageView()")
                span.mdi.mdi-tag.mdi-24px.iconlabel
                    = T("switchproductview_text", 1) 
        .col
            button.btn.btn-link#export(type="button" onclick="exportAll()")
                span.mdi.mdi-content-save.mdi-24px.iconlabel
                    = T("export_text", 1) 
        .col
            button#s_storage_archive_button.btn.btn-link(type="button" data-toggle="button" aria-pressed="true" autocomplete="off")
                span.mdi.mdi-delete.mdi-24px.iconlabel
                    = T("showdeleted_text", 1) 

    #stock.modal.fade(role="dialog" tabindex="-1" aria-labelledby="stockLabel" aria-hidden="true")
        .modal-dialog.modal-lg(role="document")
            .modal-content
                .modal-body#stock-body
                    span.mdi.mdi-36px.mdi-spin.mdi-autorenew
                .modal-footer
                    button.btn.btn-link(type="button" data-dismiss="modal")
                        span.mdi.mdi-close-box.mdi-24px.iconlabel
                            = T("close", 1)

    #exportlink.modal.fade(role="dialog" tabindex="-1" aria-labelledby="exportlinkLabel" aria-hidden="true")
        .modal-dialog.modal-sm(role="document")
            .modal-content
                .modal-body#exportlink-body.mx-auto
                .modal-footer
                    button.btn.btn-link(type="button" data-dismiss="modal")
                        span.mdi.mdi-close-box.mdi-24px.iconlabel
                            = T("close", 1)

    #borrow.modal.fade(role="dialog" tabindex="-1" aria-labelledby="borrowLabel" aria-hidden="true")
        .modal-dialog.modal-lg(role="document")
            .modal-content
                .modal-body#borrow-body
                    form#borrowing
                        input#bstorage_id(type='hidden', name='bstorage_id', value='')
                        .form-group.row
                            .form-group.col-sm-auto
                                span.badge.badge-pill.badge-danger &nbsp;
                            .form-group.col-sm-11
                                +select("borrower", "borrower")
                        .form-group.row
                            .col-sm-12
                                +inputtextarea("comment", "borrowing_comment")
                .modal-footer
                    button.btn.btn-link(type="button" onclick='saveBorrowing()')
                        span.mdi.mdi-content-save.mdi-24px.iconlabel
                            = T("save", 1)
                    button.btn.btn-link(type="button" data-dismiss="modal")
                        span.mdi.mdi-close-box.mdi-24px.iconlabel
                            = T("close", 1)

    #accordion
        #list-collapse.collapse.show(data-parent='#accordion')
            //- header.row
            //-     .col-sm-12
            table#table(data-toggle='table', 
                        data-striped='true', 
                        data-search='false', 
                        data-pagination-v-align='both',
                        data-toolbar="#toolbar",
                        data-side-pagination='server', 
                        data-page-list="[5, 10, 20, 50, 100, 200, 500]",
                        data-pagination='true', 
                        data-ajax='getData', 
                        data-query-params='queryParams',
                        data-sort-name='name.name_label',
                        data-detail-view="true",
                        data-detail-formatter="detailFormatter",
                        data-row-attributes="rowAttributes")
                thead
                    tr
                        //th(data-field='storage_id' data-formatter='storage_idFormatter' data-sortable='true') ID
                        //th(data-field='storage_modificationdate' data-formatter='dateFormatter' data-sortable='true') modification date
                        th.th-width-200(data-field='product.name.name_label' data-formatter='storage_productFormatter' data-sortable='true') product
                        th(data-field='storelocation.storelocation_fullpath' data-sortable='true' data-formatter='storelocation_fullpathFormatter') store location
                        th(data-field='storage_quantity' data-formatter='storage_quantityFormatter') quantity
                        th(data-field='storage_barecode' data-formatter='storage_barecodeFormatter' data-sortable='true') barecode
                        th(data-field='operate', data-formatter='operateFormatter', data-events='operateEvents') 

        #edit-collapse.collapse(data-parent='#accordion')

            +titleicon(iconaction="border-color" iconitem="forklift" label="update storage")

            .row
                .d-flex.justify-content-center
                    #filter-product

            form#storage
                input#index(type='hidden', name='index', value='')
                input#storage_id(type='hidden', name='storage_id', value='')

                input#exactMatchSupplier(type="hidden")

                .form-group.row
                    .form-group.col-sm-12
                        +selectrequired("store location", "storelocation")
                .form-group.row
                    .col-sm-6
                        +inputnumber("quantity", "storage_quantity", "any", "1", "10000000", "")
                    .col-sm-6
                        +select("unit", "unit") 
                .form-group.row
                    .col-sm-12
                        +select("supplier", "supplier")
                .form-group.row
                    .col-sm-3
                        +inputdate("entry date", "storage_entrydate")
                    .col-sm-3
                        +inputdate("exit date", "storage_exitdate")
                    .col-sm-3
                        +inputdate("opening date", "storage_openingdate")
                    .col-sm-3
                        +inputdate("expiration date", "storage_expirationdate")
                .form-group.row
                    .col-sm-6
                        +inputtext("reference", "storage_reference")
                    .col-sm-6
                        +inputtext("batch number", "storage_batchnumber")
                .form-group.row
                    .col-sm-12
                        +inputtext("barecode", "storage_barecode")
                .form-group.row
                    .col-sm-12
                        +inputtext("comment", "storage_comment")  
                .form-group.row
                    .col-sm-12
                        +checkbox("to destroy", "storage_todestroy")

            button#save.btn.btn-link(type='button', onclick='saveStorage()')
                span.mdi.mdi-content-save.mdi-24px.iconlabel
                    = T("save", 1)
            button.btn.btn-link(type='button', onclick='closeEdit();')
                span.mdi.mdi-content-save.mdi-24px.iconlabel
                    = T("close", 1)

block CONTENTJS
    script(src="../js/chim/product_storage.js")
    script(src="../js/chim/storage.js")

